{% extends "layouts/authenticated.html" %}
{% block title %} Transaction Details {% endblock title %}
{% block content %}
    <div id="app">
        <div class="dashboard-container">
            <!-- Logo -->
            {% include "partials/header.html" %}

            <!-- Flash messages -->
            {% include 'partials/flash.html' %}

            <!-- Back to Dashboard Link -->
            <a href="{{ url_for("user.dashboard") }}" class="wallet-info-bar" style="text-decoration: none; cursor: pointer;">
                <span class="wallet-address-short">← Back to Dashboard</span>
                <span class="wallet-address-short">{{ wallet_data.wallet_address[:6] }}...{{ wallet_data.wallet_address[-4:] }}</span>
            </a>

            <!-- Currency Balance Cards -->
            <div class="balance-cards">
                <div class="balance-card">
                    <div class="balance-icon">
                        <img src="{{ url_for('static', filename='images/solana.svg') }}" alt="SOL" />
                    </div>
                    <div class="balance-amount">{{ wallet_data.balances.sol.amount }}</div>
                </div>
                <div class="balance-card {% if transaction_data.asset|lower == 'eurc' %}balance-card-selected{% endif %}">
                    <div class="balance-icon">
                        <img src="{{ url_for('static', filename='images/eurc_token.svg') }}" alt="EURC" />
                    </div>
                    <div class="balance-amount">{{ wallet_data.balances.eurc.amount }}</div>
                </div>
                <div class="balance-card {% if transaction_data.asset|lower == 'usdc' %}balance-card-selected{% endif %}">
                    <div class="balance-icon">
                        <img src="{{ url_for('static', filename='images/usdc_token.svg') }}" alt="USDC" />
                    </div>
                    <div class="balance-amount">{{ wallet_data.balances.usdc.amount }}</div>
                </div>
            </div>

            {% if transaction_data.status.upper() != "COMPLETED" %}
                <!-- Send Exactly Amount -->
                <div class="transaction-info-row">
                    <span class="info-label">
                        {% if transaction_data.transaction_type.lower() == "deposit" %}
                            Send Exactly:
                        {% else %}
                            You Receive:
                        {% endif %}
                    </span>
                    <span class="info-value-large">
                        {% if transaction_data.transaction_type.lower() == "deposit" %}
                            €{{ transaction_data.value | round(2) }}
                        {% else %}
                            €{{ (transaction_data.value - transaction_data.fee) | round(2) }}
                        {% endif %}
                    </span>
                    <button class="copy-btn" onclick="copyToClipboard('{{ transaction_data.value | round(2) }}')">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg>
                    </button>
                </div>

                <!-- Account Name / To -->
                {% if transaction_data.transaction_type.lower() == "withdraw" %}
                    <div class="transaction-info-row">
                        <span class="info-label">Account Name:</span>
                        <span class="info-value">{{ user_data.bank_account_number | upper }}</span>
                        <button class="copy-btn" onclick="copyToClipboard('{{ user_data.bank_account_number | upper }}')">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                        </button>
                    </div>
                {% else %}
                    <div class="transaction-info-row">
                        <span class="info-label">Account Name:</span>
                        <span class="info-value">MYKOBO SP. z.o.o.</span>
                        <button class="copy-btn" onclick="copyToClipboard('MYKOBO SP. z.o.o.')">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- IBAN -->
                    <div class="transaction-info-row">
                        <span class="info-label">IBAN:</span>
                        <span class="info-value">{{ mykobo_iban }}</span>
                        <button class="copy-btn" onclick="copyToClipboard('{{ mykobo_iban }}')">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                        </button>
                    </div>
                {% endif %}

                <!-- Reference -->
                <div class="transaction-info-row">
                    <span class="info-label">Reference:</span>
                    <span class="info-value">{{ transaction_data.reference }}</span>
                    <button class="copy-btn" onclick="copyToClipboard('{{ transaction_data.reference }}')">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg>
                    </button>
                </div>
            {% endif %}
            <!-- Status Banner -->
            {% if transaction_data.status.upper() != "COMPLETED" %}
                <div class="status-banner status-waiting">
                    <span>{{ transaction_data.status | transaction_status }}</span>
                </div>

                <!-- Warning Message -->
                {% if transaction_data.transaction_type.lower() == "deposit" %}
                    <div class="warning-card">
                        <p>Please make sure you include the reference <b>{{ transaction_data.reference }}</b> when making your bank payment</p>
                    </div>
                {% else %}
                    <div class="warning-card">
                        <p>
                            We will be sending funds to this account:<br/>
                            <b>{{ user_data.bank_account_number | upper }}</b><br/>
                            If it's incorrect, please contact support immediately!
                        </p>
                    </div>
                {% endif %}
            {% else %}
                <div class="status-banner status-completed">
                    <span>Transaction Completed</span>
                </div>
                <div class="success-card">
                    <p>Thank you for your transaction.</p>
                </div>
            {% endif %}

            <!-- Transaction Summary -->
            <div class="transaction-summary-card">
                <div class="summary-row">
                    <span class="summary-label">Transaction Fee:</span>
                    <span class="summary-value">€{{ transaction_data.fee | round(2) }}</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">Amount you will get:</span>
                    <span class="summary-value">€{{ (transaction_data.value - transaction_data.fee) | round(2) }}</span>
                </div>
            </div>

            <!-- Transactions Button -->
            <button class="dashboard-action-btn full-width" onclick="window.location.href='{{ url_for('solana_transaction.list_transactions', type='withdraw') }}'">
                Transactions
            </button>
        </div>
    </div>

    <script>
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(function() {
                // Show a brief success indicator
                alert('Copied to clipboard!');
            }, function(err) {
                console.error('Could not copy text: ', err);
            });
        }
    </script>
{% endblock %}