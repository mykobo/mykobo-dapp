{% extends "layouts/authenticated.html" %}
{% block title %} Transaction Details {% endblock title %}
{% block content %}

    <!-- Wallet Info Button -->
    <a href="{{ url_for("user.dashboard") }}" class="wallet-info-button mb-2">
        <span class="wallet-address">Welcome back {{ user_data.first_name }} {{ user_data.last_name }}! </span>
        <span id="wallet-balance"
              class="wallet-balance">{{ wallet_data.wallet_address[:9] }}...{{ wallet_data.wallet_address[-4:] }}</span>
    </a>

    <!-- Currency Balance Buttons -->
    {% include "partials/currency_buttons.html" %}

    {% if transaction_data.status.upper() != "COMPLETED" %}
        <div class="card card-body rounded-3 mb-4 mt-4">
            <div class="row">
                {% if transaction_data.transaction_type.lower() == "deposit" %}
                    <span class="display-5">Send Exactly</span><br/>
                    <span class="text-lg-start display-3 pt-1 p-3">{{ transaction_data.value | round(2) }}</span>
                {% else %}
                    <span class="display-5">You Receive</span><br/>
                    <span class="text-lg-start display-3 pt-1 p-3">{{ (transaction_data.value - transaction_data.fee) | round(2) }}</span>
                {% endif %}
            </div>
            {% if transaction_data.transaction_type.lower() == "withdraw" %}
                <div class="row">
                    <div class="display-5">At</div>
                    <div class="pt-1 p-3">
                        <div class="me-auto p-1">{{ user_data.bank_account_number | upper }}
                        </div>
                    </div>
                </div>
            {% else %}
                <div class="row">
                    <div class="display-5">To</div>
                    <div class="pt-1 p-3">
                        <div class="me-auto p-1">
                            MYKOBO SP. z.o.o<br/>
                            {{ mykobo_iban }}
                        </div>
                    </div>
                </div>
            {% endif %}
            <div class="row">
                <div class="display-5">Reference</div>
                <div class="pt-1 p-3">{{ transaction_data.reference }}</div>
                <br/>
            </div>
        </div>
    {% endif %}
    <div class="card card-body rounded-3">
        <label class="badge badge-outline-{{ transaction_data.status | status_to_label }} rounded-3 mb-3">
            {{ transaction_data.status | transaction_status }}
        </label>

        {% if transaction_data.status.upper() != "COMPLETED" %}
            {% if transaction_data.transaction_type.lower() == "deposit" %}
                <div class="alert alert-warning p-2" role="alert">
                    <p>Please make sure you include the reference <b>{{ reference }}</b> when making your bank
                        payment to ensure payment is timely</p>
                </div>
            {% else %}
                <div class="alert alert-warning p-2" role="alert">
                    <p>
                        We will be sending funds to this account:<br/>
                        <b>{{ user_data.bank_account_number | upper }}</b>
                        If it's incorrect, please contact support (support@mykobo.co) immediately!
                    </p>
                </div>
            {% endif %}
        {% else %}
            <p class="text-lg-start">Thank you for your transaction.</p>
        {% endif %}
    </div>
    <div>
        <div class="table-responsive">
            <table class="table table-hover mb-4">
                <tbody>
                {% if user_data %}
                    <tr>
                        <td>
                            Requested By
                        </td>
                        <td>{{ user_data.first_name ~ " " ~ user_data.last_name }}</td>
                    </tr>
                {% endif %}

                <tr>
                    <td>Fee</td>
                    <td>{{ transaction_data.fee | round(2) }}</td>
                </tr>
                <tr>
                    <td>You get</td>
                    <td class="">{{ (transaction_data.value - transaction_data.fee) | round(2) }}</td>
                </tr>
                {% if explorer_url %}
                <tr>
                    <td>Transaction Hash</td>
                    <td>
                        <a href="{{ explorer_url }}"
                           target="_blank"
                           class="text-primary"
                           style="font-family: Courier New, monospace; font-size: 0.875rem;">
                            {{ transaction_data.tx_hash[:8] }}...{{ transaction_data.tx_hash[-8:] }}
                        </a>
                    </td>
                </tr>
                {% endif %}
                </tbody>
            </table>
        </div>
    </div>

{% endblock %}