{% extends "layouts/authenticated.html" %}
{% block title %} Your Transactions {% endblock %}
{% block content %}
    <div id="app">
        <div class="dashboard-container">
            <!-- Logo -->
            {% include "partials/header.html" %}

            <!-- Flash messages -->
            {% include 'partials/flash.html' %}

            <!-- Back to Dashboard Link -->
            <a href="{{ url_for("user.dashboard") }}" class="wallet-info-bar" style="text-decoration: none; cursor: pointer;">
                <span class="wallet-address-short">‚Üê Back to Dashboard</span>
                <span class="wallet-address-short">{% if wallet_data and wallet_data.wallet_address %}{{ wallet_data.wallet_address[:6] }}...{{ wallet_data.wallet_address[-4:] }}{% endif %}</span>
            </a>

            <!-- Currency Balance Cards -->
            <div class="balance-cards">
                <div class="balance-card">
                    <div class="balance-icon">
                        <img src="{{ url_for('static', filename='images/solana.svg') }}" alt="SOL" />
                    </div>
                    <div class="balance-amount">{{ wallet_data.balances.sol.amount }}</div>
                </div>
                <div class="balance-card">
                    <div class="balance-icon">
                        <img src="{{ url_for('static', filename='images/eurc_token.svg') }}" alt="EURC" />
                    </div>
                    <div class="balance-amount">{{ wallet_data.balances.eurc.amount }}</div>
                </div>
                <div class="balance-card">
                    <div class="balance-icon">
                        <img src="{{ url_for('static', filename='images/usdc_token.svg') }}" alt="USDC" />
                    </div>
                    <div class="balance-amount">{{ wallet_data.balances.usdc.amount }}</div>
                </div>
            </div>

            <!-- Transactions List -->
            <div class="transactions-list">
                {% if transaction_data.transactions|length > 0 %}
                    {% for transaction in transaction_data.transactions %}
                        <div class="transaction-list-card" onclick="window.location.href='{{ url_for('solana_transaction.info', reference=transaction.reference) }}'">
                            <div class="transaction-list-info">
                                <span class="transaction-list-time">{{ transaction.created_at | humanize_time }}</span>
                                <span class="transaction-list-type">{{ transaction.transaction_type }}</span>
                                <span class="transaction-list-amount">{{ transaction.value | float | round(2) }} {{ transaction.outgoing_currency }}</span>
                            </div>
                            <div class="transaction-list-status">
                                <span class="status-badge status-{{ transaction.status|lower|replace('_', '-') }}">
                                    {{ transaction.status | transaction_status }}
                                </span>
                            </div>
                        </div>
                    {% endfor %}

                    <!-- Pagination -->
                    {% if transaction_data.total > transaction_data.limit %}
                        <div class="pagination-container">
                            <div class="pagination-info">
                                <span>Showing {{ transaction_data.offset + 1 }}-{{ transaction_data.offset + transaction_data.transactions|length }} of {{ transaction_data.total }} transactions</span>
                            </div>
                            <div class="pagination-buttons">
                                {% if transaction_data.offset > 0 %}
                                    <button class="pagination-button" onclick="window.location.href='{{ url_for('solana_transaction.list_transactions', limit=transaction_data.limit, offset=0) }}'">
                                        First
                                    </button>
                                    <button class="pagination-button" onclick="window.location.href='{{ url_for('solana_transaction.list_transactions', limit=transaction_data.limit, offset=transaction_data.offset - transaction_data.limit) }}'">
                                        Previous
                                    </button>
                                {% else %}
                                    <button class="pagination-button" disabled>First</button>
                                    <button class="pagination-button" disabled>Previous</button>
                                {% endif %}

                                {% if transaction_data.offset + transaction_data.limit < transaction_data.total %}
                                    <button class="pagination-button" onclick="window.location.href='{{ url_for('solana_transaction.list_transactions', limit=transaction_data.limit, offset=transaction_data.offset + transaction_data.limit) }}'">
                                        Next
                                    </button>
                                    <button class="pagination-button" onclick="window.location.href='{{ url_for('solana_transaction.list_transactions', limit=transaction_data.limit, offset=(transaction_data.total // transaction_data.limit) * transaction_data.limit) }}'">
                                        Last
                                    </button>
                                {% else %}
                                    <button class="pagination-button" disabled>Next</button>
                                    <button class="pagination-button" disabled>Last</button>
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}
                {% else %}
                    <div class="empty-state">
                        <p>No transactions found</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}